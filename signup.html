<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>샤픽 - 회원가입</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* 기존 디자인 스타일 유지 */
        body {
            font-family: 'Pretendard', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 420px;
            background-color: white;
            min-height: 100vh;
            position: relative;
        }

        .header-bar {
            padding: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
            background: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .back-btn {
            font-size: 20px;
            text-decoration: none;
            color: #333;
            margin-right: 15px;
            border: none;
            background: none;
            cursor: pointer;
        }

        .page-title {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
        }

        .form-container {
            padding: 25px;
            padding-bottom: 100px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 15px;
            box-sizing: border-box;
        }

        .gender-selector {
            display: flex;
            gap: 10px;
        }

        .gender-option {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            color: #888;
        }

        input[type="radio"] {
            display: none;
        }

            input[type="radio"]:checked + .gender-option {
                background-color: #FFF0F3;
                border-color: #ff758c;
                color: #ff758c;
                font-weight: bold;
            }

        .bottom-btn-area {
            position: fixed;
            bottom: 0;
            max-width: 420px;
            width: 100%;
            padding: 20px;
            background: white;
            box-sizing: border-box;
            border-top: 1px solid #f0f0f0;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 16px;
            background-color: #333;
            color: white;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
        }

            .submit-btn.active {
                background: linear-gradient(90deg, #ff758c 0%, #ff7eb3 100%);
            }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header-bar">
            <button class="back-btn" onclick="history.back()">←</button>
            <h2 class="page-title">프로필 작성</h2>
        </header>

        <div class="form-container">
            <div class="input-group">
                <label class="input-label">닉네임</label>
                <input type="text" id="input-nickname" class="text-input" placeholder="본명을 쓰지 않아도 돼요">
            </div>

            <div class="input-group">
                <label class="input-label">성별</label>
                <div class="gender-selector">
                    <label style="flex:1;">
                        <input type="radio" name="gender" value="남성">
                        <div class="gender-option">남성</div>
                    </label>
                    <label style="flex:1;">
                        <input type="radio" name="gender" value="여성">
                        <div class="gender-option">여성</div>
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">학교 / 학과</label>
                <input type="text" id="input-university" class="text-input" placeholder="예: 한국대학교 기계공학부">
            </div>

            <div class="input-group">
                <label class="input-label">MBTI</label>
                <select id="input-mbti" class="text-input" style="background-color: white;">
                    <option value="">선택해주세요</option>
                    <option value="ENFP">ENFP</option>
                    <option value="ESTJ">ESTJ</option>
                    <option value="INTP">INTP</option>
                    <option value="ISFJ">ISFJ</option>
                </select>
            </div>
        </div>

        <div class="bottom-btn-area">
            <button class="submit-btn active" onclick="saveData()">
                가입 신청하기
            </button>
        </div>
    </div>

    <script>
        // -----------------------------------------------------------
        // [중요] 여기에 아까 복사한 키를 붙여넣으세요! (따옴표 '' 안에 넣어야 합니다)
        // -----------------------------------------------------------
        const PROJECT_URL = 'https://gmzvbgkxwzadpndeostq.supabase.co';
        const API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtenZiZ2t4d3phZHBuZGVvc3RxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyOTM3NTIsImV4cCI6MjA3OTg2OTc1Mn0.9VfVKumfVOPYDrwKvd4lyKjeUnKfGD5Z4v7k-Wfj140';
        // -----------------------------------------------------------

        // 수퍼베이스 시작하기
        const supabase = window.supabase.createClient(PROJECT_URL, API_KEY);

        // 데이터 저장 함수
        async function saveData() {
            // 1. 입력한 값 가져오기
            const nickname = document.getElementById('input-nickname').value;
            const university = document.getElementById('input-university').value;
            const mbti = document.getElementById('input-mbti').value;

            // 성별 가져오기 (라디오버튼이라 방식이 다름)
            const genderInput = document.querySelector('input[name="gender"]:checked');
            const gender = genderInput ? genderInput.value : null;

            // 2. 입력 안 한 거 있는지 확인
            if (!nickname || !university || !mbti || !gender) {
                alert('모든 정보를 입력해주세요!');
                return;
            }

            // 3. 데이터베이스(users 테이블)에 집어넣기 (Insert)
            const { data, error } = await supabase
                .from('users')
                .insert([
                    {
                        nickname: nickname,
                        university: university,
                        mbti: mbti,
                        gender: gender
                    }
                ]);

            // 4. 결과 확인
            if (error) {
                console.error(error);
                alert('저장에 실패했습니다 ㅠㅠ 설정을 다시 확인해주세요.');
            } else {
                alert('🎉 축하합니다! 정보가 데이터베이스에 저장되었습니다.');
                location.href = 'matching.html';
            }
        }
    </script>
</body>
</html>